<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æœ€çœå‰©é¤˜é‡‘é¡ï¼ˆå¯é‡è¤‡è³¼è²· + å‰©é¤˜å®¹è¨±ï¼‰</title>
  <style>
    :root {
      --bg: #f7fafc; --fg:#111827; --muted:#6b7280; --accent:#3b82f6; --card:#ffffff; --border:#e5e7eb; --warn:#f59e0b; --err:#ef4444;
    }
    body { margin:0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans TC', 'PingFang TC', 'Heiti TC', 'Microsoft JhengHei', Arial, sans-serif; background:var(--bg); color:var(--fg); }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
    h1 { font-size: 24px; margin: 0 0 8px; }
    .muted { color: var(--muted); font-size: 14px; }
    .grid { display: grid; gap: 16px; }
    @media (min-width: 768px) { .grid-2 { grid-template-columns: 1fr 1fr; } .grid-3 { grid-template-columns: 1fr 1fr 1fr; }}
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px; }
    input, textarea, button, select { width: 100%; font-size: 14px; padding: 10px 12px; border: 1px solid var(--border); border-radius: 12px; box-sizing: border-box; }
    input:focus, textarea:focus { outline: 2px solid var(--accent); }
    button { background: var(--accent); color: white; cursor: pointer; border: none; font-weight: 600; }
    button.secondary { background: #111827; }
    .stat { border-radius: 12px; border: 1px solid var(--border); padding: 12px; background: #f9fafb; }
    .stat .label { font-size: 12px; color: var(--muted); }
    .stat .value { font-size: 18px; font-weight: 700; margin-top: 4px; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { padding: 10px; border-bottom: 1px solid var(--border); text-align: left; }
    thead th { background: #fff; }
    .row { display:flex; gap:12px; align-items:center; }
    .warn { background:#fffbeb; border:1px solid #fef3c7; color:#78350f; border-radius:12px; padding:10px 12px; }
    .err { background:#fef2f2; border:1px solid #fee2e2; color:#7f1d1d; border-radius:12px; padding:10px 12px; }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border); background:#fff; }
  </style>
</head>
<body>
  <div class="container">
    <header class="row" style="justify-content: space-between; align-items: baseline; flex-wrap: wrap; gap: 8px;">
      <div>
        <h1>æœ€çœå‰©é¤˜é‡‘é¡ï¼ˆGitHub Pages å–®æª”ç‰ˆï¼‰</h1>
        <div class="muted">è¦å‰‡ï¼šé‡‘éŒ¢ < 200 å…ƒã€æ¯ä»¶å•†å“ < 50 å…ƒï½œæ¨¡å¼ï¼š<span class="pill">å¯é‡è¤‡è³¼è²·</span></div>
      </div>
      <a class="pill" href="#" id="fillDemo">ä¸€éµå¡«å…¥ç¯„ä¾‹</a>
    </header>

    <section class="grid grid-2" style="margin-top:16px;">
      <div class="card">
        <label>é ç®—ï¼ˆå…ƒï¼‰</label>
        <input id="budget" type="number" step="0.5" placeholder="ä¾‹å¦‚ï¼š120" value="199" />
        <div class="muted">éœ€ < 200ï¼›å¯è¼¸å…¥å°æ•¸ï¼Œå…§éƒ¨ä»¥ã€Œåˆ†ã€ç²¾æº–è¨ˆç®—ã€‚</div>
      </div>
      <div class="card">
        <label>å…è¨±çš„å‰©é¤˜é‡‘é¡ä¸Šé™ï¼ˆå…ƒï¼‰</label>
        <input id="leftoverMax" type="number" step="0.5" placeholder="ä¾‹å¦‚ï¼š3ï¼ˆä»£è¡¨å‰©ä¸‹ â‰¤ 3 å…ƒå³å¯ï¼‰" value="2" />
        <div class="muted">æ¼”ç®—æ³•æœƒåˆ—å‡ºæ‰€æœ‰ã€Œç¸½é¡åœ¨ [é ç®— âˆ’ ä¸Šé™, é ç®—]ã€ç¯„åœå…§çš„æœ€ä½³è§£ï¼ˆç”±é«˜åˆ°ä½ï¼‰ã€‚</div>
      </div>
    </section>

    <section class="grid grid-2" style="margin-top:16px;">
      <div class="card">
        <label>å•†å“æ¸…å–®ï¼ˆæ¯è¡Œï¼šåç¨±, åƒ¹æ ¼ æˆ– åªå¯«åƒ¹æ ¼ï¼‰</label>
        <textarea id="items" rows="10" placeholder="è˜‹æœ, 25\nç‰›å¥¶, 42.5\n38\né¤…ä¹¾, 15"></textarea>
        <div class="muted">æœªå¡«åç¨±æœƒè‡ªå‹•å‘½åç‚ºã€Œå•†å“1ã€å•†å“2â€¦ã€ã€‚æ¯ä»¶éœ€ < 50 å…ƒã€‚</div>
      </div>
      <div class="card">
        <div class="row">
          <button id="run">ğŸ” è¨ˆç®—æœ€ä½³çµ„åˆ</button>
          <button id="reset" class="secondary">â†º æ¸…ç©ºçµæœ</button>
        </div>
        <div id="messages" style="margin-top:12px; display:grid; gap:8px;"></div>
        <div class="grid grid-3" style="margin-top:12px;">
          <div class="stat"><div class="label">æœ€ä½³ç¸½é¡</div><div class="value" id="statBest">â€”</div></div>
          <div class="stat"><div class="label">æœ€å°å‰©é¤˜</div><div class="value" id="statLeft">â€”</div></div>
          <div class="stat"><div class="label">ç¬¦åˆæ–¹æ¡ˆæ•¸</div><div class="value" id="statCnt">â€”</div></div>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:16px;">
      <h3 style="margin:0 0 12px;">æ–¹æ¡ˆåˆ—è¡¨ï¼ˆç”±ç¸½é¡é«˜ â†’ ä½ï¼‰</h3>
      <div id="list"></div>
    </section>

    <footer style="margin-top:24px;" class="muted">
      Â© æœ€çœå‰©é¤˜é‡‘é¡å°å¹«æ‰‹ Â· å¯é‡è¤‡è³¼è²·ï¼ˆUnboundedï¼‰ç‰ˆ Â· å¯ç›´æ¥éƒ¨ç½²åˆ° GitHub Pages
    </footer>
  </div>

<script>
// ===== å·¥å…·ï¼šæ ¼å¼åŒ–å¹£å€¼ =====
function toCents(x){ return Math.round(Number(x) * 100); }
function money(c){ return (c/100).toLocaleString('zh-TW',{style:'currency',currency:'TWD',minimumFractionDigits:2}); }

// ===== è§£æè¼¸å…¥ =====
function parseInputs(){
  const msgs = [];
  const warns = [];

  const budgetStr = document.getElementById('budget').value.trim();
  if(!budgetStr){ return {ok:false, msgs:[err('è«‹è¼¸å…¥é ç®—ï¼ˆå…ƒï¼‰ã€‚')]}; }
  const budget = Number(budgetStr);
  if(!isFinite(budget) || budget<=0){ return {ok:false, msgs:[err('é ç®—éœ€ç‚ºå¤§æ–¼ 0 çš„æ•¸å­—ã€‚')]}; }
  if(budget >= 200){ warns.push(warn('é ç®—éœ€ < 200 å…ƒï¼Œå°‡ä»¥ 199.99 å…ƒè¨ˆç®—ã€‚')); }
  const budgetCents = Math.min(toCents(budget), 19999);

  const leftStr = document.getElementById('leftoverMax').value.trim();
  const leftoverMax = Math.max(0, Number(leftStr || 0));
  const leftoverMaxCents = toCents(leftoverMax);

  const raw = document.getElementById('items').value.split(/\n+/).map(s=>s.trim()).filter(Boolean);
  if(raw.length===0){ return {ok:false, msgs:[err('è«‹è‡³å°‘è¼¸å…¥ 1 å€‹å•†å“ã€‚')]}; }

  const items=[];
  for(let i=0;i<raw.length;i++){
    let name = `å•†å“${i+1}`; let priceStr = raw[i];
    if(raw[i].includes(',')){
      const parts = raw[i].split(',');
      name = (parts[0]||name).trim();
      priceStr = parts.slice(1).join(',').trim();
    }
    const price = Number(priceStr);
    if(!isFinite(price) || price<=0){ warns.push(warn(`ç¬¬ ${i+1} è¡Œåƒ¹æ ¼ç„¡æ•ˆï¼Œå·²ç•¥éï¼ˆå…§å®¹ï¼šã€Œ${raw[i]}ã€ï¼‰`)); continue; }
    if(price >= 50){ warns.push(warn(`ã€Œ${name}ã€å–®åƒ¹éœ€ < 50 å…ƒï¼Œå·²ç•¥éï¼ˆ${price}ï¼‰ã€‚`)); continue; }
    items.push({id:i, name, priceCents: toCents(price)});
  }
  if(items.length===0){ return {ok:false, msgs:[err('æ²’æœ‰ç¬¦åˆè¦å‰‡ï¼ˆå–®å“ < 50 å…ƒï¼‰çš„å•†å“ã€‚')]}; }

  return { ok:true, budgetCents, leftoverMaxCents, items, msgs:[...warns] };
}

function warn(text){ const d=document.createElement('div'); d.className='warn'; d.textContent='âš ï¸ '+text; return d; }
function err(text){ const d=document.createElement('div'); d.className='err'; d.textContent='âŒ '+text; return d; }

// ===== æ¼”ç®—æ³•ï¼šå¯é‡è¤‡è³¼è²·ï¼ˆUnboundedï¼‰ï¼Œåˆ—å‡ºæ‰€æœ‰å¯é”ç¸½é¡ =====
function solveUnboundedAll(budgetCents, items){
  const dp = new Array(budgetCents+1).fill(false); dp[0]=true;
  const prev = new Array(budgetCents+1).fill(-1);

  for(let s=0;s<=budgetCents;s++){
    if(!dp[s]) continue;
    for(let i=0;i<items.length;i++){
      const ns = s + items[i].priceCents;
      if(ns<=budgetCents && !dp[ns]){ dp[ns]=true; prev[ns]=i; }
    }
  }

  return {reachable: dp, prev};
}

function reconstructCombo(sum, prev, items){
  const m=new Map(); let cur=sum;
  while(cur>0){ const i=prev[cur]; if(i<0) break; m.set(i,(m.get(i)||0)+1); cur-=items[i].priceCents; }
  const arr=[...m.entries()].map(([i,q])=>({name:items[i].name, qty:q, priceCents:items[i].priceCents}));
  arr.sort((a,b)=> a.name.localeCompare(b.name,'zh-Hant'));
  return { items: arr, totalCents: sum };
}

// ===== UI ç¶å®š =====
const btnRun = document.getElementById('run');
const btnReset = document.getElementById('reset');
const messages = document.getElementById('messages');
const list = document.getElementById('list');
const statBest = document.getElementById('statBest');
const statLeft = document.getElementById('statLeft');
const statCnt = document.getElementById('statCnt');
const fillDemo = document.getElementById('fillDemo');

fillDemo.addEventListener('click', (e)=>{
  e.preventDefault();
  document.getElementById('budget').value = '120';
  document.getElementById('leftoverMax').value = '3';
  document.getElementById('items').value = [
    'è˜‹æœ, 25', 'ç‰›å¥¶, 42.5', 'éºµåŒ…, 38', 'é¤…ä¹¾, 15', 'è±†æ¼¿, 18.5', 'èŒ¶è‘‰è›‹, 12', 'å„ªæ ¼, 28', 'æ³¡éºµ, 32'
  ].join('\n');
});

btnReset.addEventListener('click', ()=>{
  messages.innerHTML=''; list.innerHTML='';
  statBest.textContent='â€”'; statLeft.textContent='â€”'; statCnt.textContent='â€”';
});

btnRun.addEventListener('click', ()=>{
  messages.innerHTML=''; list.innerHTML='';
  const parsed = parseInputs();
  if(!parsed.ok){ parsed.msgs.forEach(n=>messages.appendChild(n)); return; }
  parsed.msgs.forEach(n=>messages.appendChild(n));

  const {budgetCents, leftoverMaxCents, items} = parsed;
  const {reachable, prev} = solveUnboundedAll(budgetCents, items);

  const lo = Math.max(0, budgetCents - leftoverMaxCents);
  const goodSums = [];
  for(let s=budgetCents; s>=lo; s--){ if(reachable[s]) goodSums.push(s); }

  if(goodSums.length===0){
    messages.appendChild(err('åœ¨ç›®å‰çš„ã€Œå‰©é¤˜ä¸Šé™ã€ä¸‹æ²’æœ‰å¯è¡Œçµ„åˆã€‚å»ºè­°ç¨å¾®æ”¾å¯¬ä¸Šé™æˆ–èª¿æ•´å•†å“åƒ¹æ ¼ã€‚'));
    statBest.textContent='â€”'; statLeft.textContent='â€”'; statCnt.textContent='0';
    return;
  }

  statBest.textContent = money(goodSums[0]);
  statLeft.textContent = money(budgetCents - goodSums[0]);
  statCnt.textContent = String(goodSums.length);

  // ç”¢å‡ºåˆ—è¡¨ï¼ˆæœ€å¤šé¡¯ç¤ºå‰ 50 å€‹ï¼‰
  const maxShow = 50;
  const frag = document.createDocumentFragment();
  goodSums.slice(0, maxShow).forEach((sum, idx)=>{
    const combo = reconstructCombo(sum, prev, items);
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <div class="row" style="justify-content: space-between;">
        <div><strong>æ–¹æ¡ˆ #${idx+1}</strong></div>
        <div class="muted">ç¸½é¡ï¼š${money(combo.totalCents)}ï½œå‰©é¤˜ï¼š${money(budgetCents - combo.totalCents)}</div>
      </div>
      <div style="overflow:auto; margin-top:8px;">
        <table>
          <thead><tr><th>å“å</th><th>å–®åƒ¹</th><th>æ•¸é‡</th><th>å°è¨ˆ</th></tr></thead>
          <tbody>
            ${combo.items.map(it=>`
              <tr>
                <td>${escapeHtml(it.name)}</td>
                <td>${money(it.priceCents)}</td>
                <td>${it.qty}</td>
                <td>${money(it.priceCents * it.qty)}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    `;
    frag.appendChild(card);
  });

  if(goodSums.length>maxShow){
    const tip=document.createElement('div'); tip.className='warn';
    tip.textContent = `âš ï¸ å¯è¡Œæ–¹æ¡ˆå¾ˆå¤šï¼ˆ${goodSums.length} çµ„ï¼‰ï¼Œåƒ…é¡¯ç¤ºå‰ ${maxShow} çµ„ã€‚è«‹æé«˜å‰©é¤˜ä¸Šé™æˆ–èª¿æ•´å•†å“ä»¥ç¸®å°ç¯„åœã€‚`;
    messages.appendChild(tip);
  }

  list.appendChild(frag);
});

function escapeHtml(s){
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;');
}
</script>
</body>
</html>
